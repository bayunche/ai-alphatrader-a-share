{
  "location": {
    "module": "App.tsx",
    "related": [
      "services/marketService.ts"
    ],
    "context": "前端主应用组件，负责交易时段判断、行情拉取、持仓补价与搜索逻辑"
  },
  "current_state": {
    "loops": {
      "main": "useEffect 设置 setInterval 每 60s + 首次 2s 调用 runTradingCycle；行情成功后恢复，失败时标记 marketHealthy=false 并暂停交易逻辑；非交易时同一关键字仅首开拉一次",
      "light_refresh": "marketData 变更后每 15-30s 拉取当前页前 10 只的批量报价，非交易或行情异常时跳过",
      "pool_cycle": "池内快速刷新非交易时跳过；行情异常时暂停，恢复后继续"
    },
    "health": {
      "agent": "新增 checkModelAvailability，支持 Gemini/OpenAI 兼容/Ollama，可在设置页显示可用/不可用标签并手动触发检查，启动前若不可用会拦截",
      "broker": "新增 brokerHealth（/health 探活，用户手动配置 endpoint），真实模式不可用时禁止启动",
      "market": "marketHealthy/marketError 标记，行情失败会提示标签并暂停交易"
    },
    "risk": "executeTradeForAgent 引入滑点、限价偏离、单次/单标的风险控制，行情异常时拒绝下单",
    "trading_time_fn": "isTradingTimeNow 判断周末与 09:30-11:30、13:00-15:00"
  },
  "tech_stack": {
    "frontend": "Vite + React + TypeScript",
    "data_source": "services/marketService.ts 通过后端 /api/market、/quotes，或回退东财/英为",
    "health": "services/healthService.ts 新增模型/券商可用性检查"
  },
  "tests": {
    "current": "无前端自动化测试，现有行为需人工验证",
    "notes": "未有针对交易时段逻辑的用例"
  },
  "observation": {
    "gaps": [],
    "direction": "已按需求加入节流、健康检查、风控与行情异常暂停；后续可接入真实券商下单接口映射并完善 UI 提示"
  }
}
